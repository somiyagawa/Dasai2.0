<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【最終形態Ver.2.4】激ダサホームページメーカー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'MS PGothic', 'Osaka', 'IPAMonaPGothic', 'Mona', 'HG創英角ポップ体', 'Arial', sans-serif; /* AA表示も考慮 */
        }
        /* 点滅アニメーション */
        @keyframes blink {
            0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
            25% { opacity: 0.1; transform: scale(1.08) rotate(-1.5deg); } 
            50% { opacity: 1; transform: scale(0.99) rotate(0deg); }
            75% { opacity: 0.1; transform: scale(1.08) rotate(1.5deg); }
        }
        .ugly-blink {
            animation: blink 1.2s linear infinite; 
        }
        .icon-blink {
            display: inline-block;
            animation: blink 0.9s linear infinite alternate; 
        }

        /* スクロール（マーキー）アニメーション */
        .ugly-marquee-container {
            width: 100%;
            overflow: hidden;
            padding: 12px 0;
            margin: 18px 0;
            border: 8px ridge hotpink; 
            transform: skewY(-1.5deg) rotate(0.3deg); 
        }
        .ugly-marquee-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee-scroll 15s linear infinite; 
            white-space: nowrap;
            font-size: 26pt; 
            font-weight: 900;
            text-shadow: 2px 2px 0px lime, -2px -2px 0px magenta, 0 0 3px yellow; 
        }
        @keyframes marquee-scroll {
            0%   { transform: translateX(40px) rotate(-1.5deg) skewX(-3deg); }
            25%  { transform: translateX(-170%) rotate(0.3deg) skewX(0.8deg) scaleY(1.05); }
            50%  { transform: translateX(-370%) rotate(1.5deg) skewX(3deg) scaleY(0.95); }
            75%  { transform: translateX(-570%) rotate(-0.3deg) skewX(-0.8deg) scaleY(1.02); }
            100% { transform: translateX(-770%) rotate(-1.5deg) skewX(-3deg); }
        }

        /* 虹色テキスト */
        .ugly-rainbow-text {
            background-image: linear-gradient(60deg, red,deeppink,orange,yellow,lime,springgreen,cyan,blue,darkviolet,magenta,red,deeppink,orange,yellow,lime,springgreen,cyan,blue,darkviolet,magenta);
            background-size: 350% auto; 
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900; 
            animation: rainbow-flow 2.5s linear infinite; 
        }
        @keyframes rainbow-flow {
            0% { background-position: 0% center; }
            50% { background-position: 175% center; } 
            100% { background-position: 350% center; }
        }

        /* タイトルアニメーション各種 */
        @keyframes wavy-text-anim { 
            0%, 100% { transform: translateY(0) rotate(0deg) skewX(0deg) scale(1); } 15% { transform: translateY(-8px) rotate(-2deg) skewX(5deg) scale(1.08); } 30% { transform: translateY(4px) rotate(1deg) skewX(-3deg) scale(0.97); } 45% { transform: translateY(-6px) rotate(2deg) skewX(4deg) scale(1.03); } 60% { transform: translateY(5px) rotate(-0.5deg) skewX(-4deg) scale(1.01); } 75% { transform: translateY(-3px) rotate(1deg) skewX(2deg) scale(0.93); } 90% { transform: translateY(2px) rotate(-1deg) skewX(-2deg) scale(1.005); }
        }
        .title-char-wavy { display: inline-block; animation: wavy-text-anim 2.2s ease-in-out infinite; } 

        @keyframes bounce-char-anim { 
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-7px);}
        }
        .title-char-bounce { display: inline-block; animation: bounce-char-anim 2.5s ease-in-out infinite; } 

        @keyframes spin-zoom-char-anim { 
            0%, 100% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(360deg) scale(1.25); } 
        }
        .title-char-spinzoom { display: inline-block; animation: spin-zoom-char-anim 3.0s linear infinite; } 
        
        @keyframes shake-char-anim { 
             0% { transform: translate(0.5px, 0.5px) rotate(0deg); } 10% { transform: translate(-0.5px, -1px) rotate(-0.3deg); } 20% { transform: translate(-1.5px, 0px) rotate(0.3deg); } 30% { transform: translate(1.5px, 1px) rotate(0deg); } 40% { transform: translate(0.5px, -0.5px) rotate(0.3deg); } 50% { transform: translate(-0.5px, 1px) rotate(-0.3deg); } 60% { transform: translate(-1.5px, 0.5px) rotate(0deg); } 70% { transform: translate(1.5px, 0px) rotate(-0.3deg); } 80% { transform: translate(-0.5px, -0.5px) rotate(0.3deg); } 90% { transform: translate(0.5px, 1px) rotate(0deg); } 100% { transform: translate(0.5px, -1px) rotate(-0.3deg); }
        }
        .title-char-shake { display: inline-block; animation: shake-char-anim 1.5s linear infinite; } 

        /* ダサいモーダル */
        .ugly-modal {
            position: fixed; top: 50%; left: 50%; 
            transform: translate(-50%, -50%) rotate(0.5deg) scale(1); 
            padding: 20px; 
            border: 8px outset lime; 
            z-index: 30000; text-align: center; 
            box-shadow: 0 0 25px 8px rgba(255,0,0,0.6); 
            display: none; 
            min-width: 320px; 
            max-width: 85vw; 
        }
        .ugly-modal h3 { font-size: 2.0em; margin-bottom: 15px; } 
        .ugly-modal p { margin-bottom: 15px; font-size: 1.1em; line-height: 1.4; } 
        .ugly-modal button { 
            padding: 10px 20px; 
            border: 7px groove cyan; 
            cursor: grabbing; font-weight: 900; 
            transform: skewX(-8deg) rotate(-0.5deg) scale(1); 
        }
        
        #outputArea { border: 15px groove fuchsia; padding: 35px; margin-top: 40px; min-height: 500px; background-color: #A0A0A0; overflow: hidden; position: relative; }

        .speech-bubble { position: relative; padding: 30px; margin: 2.5em 0 4.5em; border: 6px solid black; border-radius: 25px; display: inline-block; max-width: 99%; }

        .ugly-rainbow-bg { background: linear-gradient(170deg, red,darkorange,gold,yellow,lime,forestgreen,springgreen,cyan,deepskyblue,blue,darkviolet,purple,magenta,deeppink,red,darkorange,gold,yellow,lime,forestgreen,springgreen,cyan,deepskyblue,blue,darkviolet,purple,magenta,deeppink); animation: rainbow-bg-flow 3.5s ease infinite; background-size: 800% 800%; } 
        @keyframes rainbow-bg-flow { 0%{background-position:0% 95%} 50%{background-position:100% 5%} 100%{background-position:0% 95%} }
        
        #downloadButton { margin-top: 30px; padding: 15px 30px; font-size: 1.8em; font-weight: 900; border: 8px outset #FF4500; background-image: linear-gradient(to bottom, #FFA500, #FF0000); color: white; text-shadow: 3px 3px 2px black, 0 0 10px yellow; border-radius: 20px; cursor: help; display: block; margin-left: auto; margin-right: auto; width: fit-content; transform: rotate(-1deg) skewX(2deg); }
        #downloadButton:hover { transform: scale(1.1) rotate(1deg) skewX(-3deg); box-shadow: 0 0 25px #FFFF00, 0 0 12px #00FF00; }

        .ascii-art-block { padding: 12px; margin: 18px auto; border: 4px dotted; overflow-x: auto; white-space: pre; font-family: 'MS PGothic', 'IPAMonaPGothic', 'Mona', monospace !important; line-height: 1.15; font-size: 9pt; text-align: left; display: inline-block; max-width: 100%; }
        /* 生成コンテンツ内でのスタイルリセット */
        #generatedContent * { box-sizing: border-box !important; margin:0 !important; padding:0 !important; }
        #generatedContent table, #generatedContent th, #generatedContent td { border-collapse: separate !important; caption-side: bottom !important; }
        #generatedContent img { max-width: 100% !important; height: auto !important; display: block !important; margin: 12px auto !important; border: 6px solid yellow !important; }

    </style>
</head>
<body class="bg-gray-500 p-4 md:p-8">
    <div class="container mx-auto max-w-7xl bg-white shadow-xl rounded-4xl p-12 border-12 border-dashed border-blue-700 transform -rotate-0.5"> <header class="text-center mb-20">
            <h1 id="mainTitleContainer" class="text-8xl font-black" style="font-family: 'Impact', fantasy; line-height: 1.2;"></h1>
            <p class="text-black mt-6 text-3xl">あなたのホームページを、<strong class="ugly-rainbow-text ugly-blink" style="font-size:1.8em; display: inline-block; padding: 8px; border: 4px dashed red; background-color:yellow;">銀河級の「ダサさ」</strong>で再構築し、<span class="icon-blink">☣️</span><span class="icon-blink">☢️</span><span class="icon-blink">📛</span><strong class="ugly-rainbow-text" style="text-shadow: 2px 2px black;">いい感じにダサく</strong>します！</p>
        </header>

        <div class="input-section mb-16 p-10 border-10 border-double border-green-600 rounded-2xl bg-orange-100 transform rotate-0.5 skew-x-0.2"> 
            <div class="mb-10">
                <label for="pageTitle" class="block text-4xl font-black text-red-700 mb-4 transform -rotate-1">ホームページのタイトル<span class="text-blue-800 font-black text-5xl ugly-blink">*</span></label>
                <input type="text" id="pageTitle" class="w-full p-6 border-8 border-yellow-600 rounded-3xl focus:ring-pink-600 focus:border-pink-600 text-3xl placeholder-gray-500" placeholder="例：山田ポチのイケてる（？）秘密基地">
            </div>
            <div class="mb-10">
                <label for="pageContent" class="block text-4xl font-black text-purple-700 mb-4 transform -rotate-1">ホームページの内容<span class="text-green-800 font-black text-5xl ugly-blink">*</span></label>
                <textarea id="pageContent" rows="18" class="w-full p-6 border-8 border-cyan-600 rounded-3xl focus:ring-orange-600 focus:border-orange-600 text-3xl placeholder-gray-500" placeholder="例：ここは僕の趣味とか日常とか、ちょっとイタいポエムとかを記録するページだよ！ゆっくり見ていってね！見にくさも楽しんでくれると嬉しいな！"></textarea>
            </div>
            <button id="generateButton" class="w-full bg-gradient-to-tr from-pink-400 via-purple-600 to-blue-700 hover:from-pink-500 hover:via-purple-700 hover:to-blue-800 text-yellow-300 font-black py-7 px-14 rounded-full text-5xl shadow-2xl transform hover:scale-110 hover:rotate-0.5 hover:skew-y-0.5 transition-all duration-200 border-4 border-white"> 
                <span style="font-family: 'HG創英角ポップ体', cursive;" class="icon-blink">🔱</span> 激ダササイトを錬成！ <span style="font-family: 'HG創英角ポップ体', cursive;" class="icon-blink">🔮</span>
            </button>
        </div>

        <hr class="my-20 border-t-12 border-black border-double transform rotate-0.2"> 
        <h2 class="text-6xl font-black text-center text-red-800 mb-12 transform -rotate-1">
            <span class="ugly-rainbow-text ugly-blink">【閲覧推奨？】</span>生成結果プレビュー<span class="ugly-rainbow-text ugly-blink">【ダサさ満開】</span>
        </h2>
        <div id="outputArea" class="bg-gray-400 p-10 rounded-3xl shadow-inner transform rotate-0.2"> 
            <p class="text-black text-center text-3xl">ここに、ダサさと見にくさを追求したホームページが表示されます。お楽しみに！</p>
        </div>
        <button id="downloadButton" style="display:none;">この激ダサHTMLをダウンロード！</button>
    </div>

    <div id="uglyModal" class="ugly-modal">
        <h3 id="modalTitle">タイトル</h3>
        <p id="modalMessage">メッセージ</p>
        <img id="modalGif" src="" alt="GIF" style="width:80px; height:80px; margin: 0 auto 15px auto; border: 4px groove yellow;"> 
        <div id="modalIcons" class="mb-3"></div>
        <button id="closeModalButton">閉じるのだ！</button>
    </div>

    <script>
        // Tone.jsのシンセサイザーとメロディ定義
        let synth;
        const melodies = [
            { notes: ['C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4'], durations: ['4n', '4n', '4n', '2n', '4n', '4n', '2n'], tempo: 100 }, 
            { notes: ['F3', 'A3', 'C4', 'F4', 'A3', 'F4', 'C4', 'A3'], durations: ['8n', '8n', '8n', '8n', '4n', '4n', '4n', '2n'], tempo: 90 }, 
            { notes: ['G2', 'D3', 'G3', 'B3', 'D4', 'G3', 'D3', 'G2'], durations: ['2n', '4n', '4n', '4n', '2n', '4n', '4n', '1n'], tempo: 70 }, 
            { notes: ['C3', 'E3', 'G3', 'C4', 'E4', 'G4', 'C5', 'G4', 'E4', 'C4', 'G3', 'E3'], durations: '8n', tempo: 120 } 
        ];
        let currentMelody;
        let part;

        function playUglyMidi() {
            if (Tone.context.state !== 'running') {
                Tone.start(); 
            }
            if (!synth) {
                synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: { type: getRandomElement(['triangle', 'sawtooth', 'square', 'pulse']) }, 
                    envelope: { attack: 0.02, decay: 0.3, sustain: 0.15, release: 0.4 }, 
                    volume: -18 
                }).toDestination();
            }
            if (part) {
                part.stop(0);
                part.dispose();
            }

            currentMelody = getRandomElement(melodies);
            const sequence = [];
            let currentTime = 0;
            for (let i = 0; i < currentMelody.notes.length; i++) {
                const duration = Tone.Time(Array.isArray(currentMelody.durations) ? currentMelody.durations[i] : currentMelody.durations).toSeconds();
                sequence.push({
                    time: currentTime,
                    note: currentMelody.notes[i],
                    duration: duration
                });
                currentTime += duration;
            }
            
            part = new Tone.Part((time, value) => {
                synth.triggerAttackRelease(value.note, value.duration, time);
            }, sequence).start(0);
            part.loop = true;
            part.loopEnd = currentTime;
            Tone.Transport.bpm.value = currentMelody.tempo;
            Tone.Transport.start();
        }

        const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const garishColorPairs = [ 
            { bg: 'red', text: 'lime' }, { bg: 'blue', text: 'yellow' }, { bg: 'yellow', text: 'fuchsia' },
            { bg: 'lime', text: 'red' }, { bg: 'cyan', text: 'magenta' }, { bg: 'magenta', text: 'yellow' },
            { bg: 'black', text: 'lime' }, { bg: 'white', text: 'blue' }, { bg: '#FF00FF', text: '#00FF00'},
            { bg: '#00FFFF', text: '#FF0000'}, {bg: 'orange', text: 'darkblue'}, {bg: 'green', text: 'deeppink'}, {bg: 'gold', text: 'purple'},
            {bg: 'darkred', text: 'chartreuse'}, {bg: 'navy', text: 'orangeRed'}, {bg: 'teal', text: 'hotpink'},
            {bg: '#003300', text: '#FF99CC'}, {bg: '#330033', text: '#CCFF99'},
            {bg: 'yellow', text: 'blue'}, {bg: 'red', text: 'cyan'}, {bg: 'lime', text: 'magenta'}
        ];
        const badFonts = ['Comic Sans MS', 'Papyrus', 'Impact', 'Times New Roman', 'Courier New', 'Arial Black', 'MS Mincho', 'MS Gothic', 'Verdana', 'Brush Script MT', 'Hobo Std', 'Curlz MT', 'Wingdings', 'Webdings', 'Zapf Dingbats', 'HG創英角ポップ体', 'HG丸ゴシックM-PRO', 'System', 'Monaco', 'IPAMonaPGothic', 'Mona', 'DFPOPBody-W12'];
        const annotations = [ 
            "※個人の感想です。", "※これはフィクションのつもりです。",
            "※イメージなので、実際とは異なるかも。", "※当社比！（何の？）", "（笑）", "www", "（たぶん）",
            "※念のため言っておきますが、ジョークですよ。", "※あくまで個人の見解です。", "※読みにくかったらゴメンナサイ！でも、それが味！",
            "※マネしないでね！", "※画面から少し離れて見てね。", "※これはポエムなんです。",
            "※この記事には、たくさんの誇張と妄想と希望的観測が含まれてるかも。", "※信じるか信じないかはあなた次第！（古）", "※自己責任で楽しんでね！クレームは受け付けません（笑）",
            "※この文章はランダム生成です（たぶん本当）", "※注釈を読むより本文を楽しんで！", "※この注釈はオマケです。"
        ];
        const verboseLeadIns = [ 
            "さて、みんな！ここで注目してくれたまえ！この驚きの事実に… ", "つまりだ、要するにだな…いや、やっぱり詳しく説明しよう！よく見ててね！ ", "別の角度から、いや、いっそ斬新な視点から言わせてもらうならばだな…聞いてくれ！ ",
            "驚天動地！空前絶後！の（かもしれない）情報が今、解禁される！ ", "前代未聞！（だといいな）この話を聞いてくれ！心して聞くように！ ", "声を大にして言いたいのは、この点だ！注目だ！そして楽しんでくれ！ "
        ];
        const verboseTrailOuts = [ 
            "…というわけなのだよ、友よ。まあいい、我が同士（自称）にしてやろう。", "…ご理解いただけただろうか？ダメならもう一周読んでみて！", "…なのであります！異論は…あるかもしれないけど、まあいいじゃないか！",
            "…と、まあそういう複雑そうで単純なカラクリなわけですわ。おほほ。理解できなくてもOK！", "…お分かりかな？フフフ…分からぬなら、それがまた一興！", "…今日のところはこれくらいにしておこう。楽しんでくれたまえ！"
        ];
        const titlePrefixes = ["【衝撃】", "★激安★", "≪必見≫", "☆驚愕の事実☆", "【号外】", "◆◇◆", "†伝説の†", "卍極秘卍", "【注目】"];
        const titleSuffixes = ["！！！", "ｗｗｗ", "（秘）", "DX", "202X", "RETURNS", "～新たなる序章～", "Ver.Final (仮)", "（かもね）"];
        const classicGifs = [ 
            "https://placehold.co/80x80/FFFF00/000000/?text=超絶神NEW!",
            "https://placehold.co/140x60/0000FF/FFFFFF/?text=絶賛お祭り騒ぎ中だぜ！", // 変更
            "https://placehold.co/60x60/FF0000/FFFFFF/?text=★神降臨覚醒★",
            "https://placehold.co/180x80/00FF00/000000/?text=MAIL ME IF YOU DARE"
        ];
        const placeholderImages = [ 
            "https://placehold.co/180x180/FF00FF/00FFFF/?text=謎の超究極物体XΩFinal",
            "https://placehold.co/220x140/00FF00/FF0000/?text=謎の超究極生命体Z改二",
            "https://placehold.co/140x200/FFFF00/0000FF/?text=謎の超究極オーパーツYPrime",
            "https://placehold.co/120x120/000000/FFFFFF/?text=神秘的な画像" // 変更
        ];
        const uglyIcons = ['✨', '🌟', '💫', '💥', '🔥', '🚀', '🎉', '🎊', '💯', '💔', '💣', '👾', '👽', '💀', '😂', '💩', '☢️', '☣️', '🤯', '😱', '🌌', '🌠', '🪐', '🛸', '💸', '💎', '🌀', '☄️', '🔮', '🧿', '📛', '🔱', '⚜️', '🔔'];
        const oldNetSlang = [ 
            "ちょｗｗｗ", "乙！", "ktkr", "orz", "GJ!", "kwsk", "wktk", "うp", "鯖落ち？", "禿同かも", "リア充いいな！", "m9(^Д^)ﾌﾟｷﾞｬｰ（冗談）", "キボンヌ！", "頑張って！（愛を込めて）", //変更
            "ネットの世界は奥深いね！", //変更
            "香具師さん乙", "詳細キボンヌ！", ">>1乙です！"
        ];
        const pseudoBusinessJargon = [ 
            "このイシューに対しては、まずKPIを再定義し、ステークホルダー間のコンセンサス形成をプライオリティに置くべきです。その上で、アジャイルなPDCAサイクルを回し、シナジー効果を最大化するソリューションをローンチする必要がありますね。…なんてね！",
            "サステナビリティを考慮したデジタルトランスフォーメーション(DX)は、エンゲージメントを高め、コアコンピタンスを強化する上で不可欠なパラダイムシフトと言えるでしょう。リソースを最適にアロケーションし、イノベーティブなエコシステムを構築することが急務です。…たぶん！",
            "当社のバリュープロポジションは、顧客インサイトに基づいたペルソナ設定とカスタマージャーニーの最適化にあります。これにより、コンバージョンレートを向上させ、最終的にはROIの最大化にコミットします。エビデンスベースでリスケし、ウィンウィンな関係を目指しましょう。…なんちゃって！"
        ];
        const kaomojiSymbols = ["(^_^;)", "m(_ _)m", "orz", "((´；ω；｀)ﾌﾞﾜｯ", "Σ(ﾟДﾟ；≡；ﾟдﾟ)", "ｷﾀ━━━━(ﾟ∀ﾟ)━━━━!!", "( ´ー｀)ﾌｩｰ．．．（遠い目）", "ヽ(`Д´)ﾉｳﾜｧｧｧﾝ!!", "†卍【最強】卍†（自称）", "☆彡(ﾉﾟ▽ﾟ)ﾉ☆彡ﾍ(ﾟ▽ﾟﾍ)☆彡(ﾉﾟ▽ﾟ)ﾉ☆彡ｳｪｰﾌﾞ!!", "＿|￣|○⇒＿|＼○＿⇒＿/＼○＿⇒＿__＿○＿ｺﾞﾒﾝﾅｻｲ!!", "（　＾ω＾）・・・おっおっおっ", "（ ´∀｀）つ§　どうぞ", "（・∀・）ﾆﾔﾆﾔ", "（ﾟДﾟ)ﾊｧ?", "工ｴｴｪｪ(´д｀)ｪｪｴｴ工", "( ´,_ゝ｀)ﾌﾟｯ", "m9（＾Д＾）ﾌﾟｷﾞｬｰ（愛）", "( ´Д｀)=3"];
        const asciiArtSamples = [ 
            "　　　　　　　　　　　　　　　　 　 　 　 ,, 、\n　　　　　　　　　　　　　　　　　　　　　　ヾ　ヽ\n　　　　　　　　　　　　　　　　　　　　　　　 `ー'''\n　　　　　　　　　　　　　　　　　　　　　 ,, -'''\"\n　　　　　　　　　　　　　　　　　　　／　　　　　　　ヽ\n　　　　　　　　　　　　　　　　　　/　　●　　　 ●　ヽ\n　　　　　　　　　　　　　　　　　　|　　　　( _●_)　　ミ　　　　モナー\n　　　　　　　　　　　　　　　　　彡､　　　|∪|　　　､｀＼\n　　　　　　　　　　　　　　　　 /　＿＿　ヽノ　/´>　 ) )\n　　　　　　　　　　　　　　　　(＿＿＿）　　　/　(_／\n　　　　　　　　　　　　　　　　　|　　　　　　 /|\n　　　　　　　　　　　　　　　　　|　　／＼　＼|\n　　　　　　　　　　　　　　　　　|　/　　　 )　 )\n　　　　　　　　　　　　　　　　　∪　　　 （　 ＼\n　　　　　　　　　　　　　　　　　　　　　　 ＼＿)",
            "　 ∧＿∧\n　（　・∀・）　　　ギコ猫\n　（　∪ ∪\n　と＿）__）",
            "　 ∧∧\n　(,,ﾟДﾟ)　やる夫\n　⊂⊂｜\n　　 し`Ｊ",
            "ｷﾀ━━━━━━(ﾟ∀ﾟ)━━━━━━!!!!",
            "　　　　　　　 ,,　＿\n　　　　　　　／ 　　　 ｀ ､\n　　　　　　/　　(_ﾉL_）　 ヽ\n　　　　　 /　　 ´・　 ・｀　　l　　　しぃ\n　　　　 （l　 　　　し　　　　l）\n　　　　　l　　　　＿＿　　 l\n　　　　　 >　､ _ 　　　　 ィ\n　　　　 ／　 　　　￣　　 ヽ\n　　 　 /　|　　　　　　　　　|ヽ\n　　　　|　|　　　　　　　　　|　|\n　　　　|　|　　　　　　　　　|　|\n",
            "　　　　　　＿＿＿\n　　　　　／　 ―　　＼\n　　　　／　　(●)　 (●)＼\n　　　 |　　　 （__人__）　 |　　　まあ、いいか\n　　　 ＼　　　 ｀⌒´　 ／\n　　　／´　 　　　　　 ｀＼\n　　/　 /　　　　　　　　ヽ\n　　|　　ヽ　　　　　　　 　ﾄ､\n", //変更
            "　♪　∧__,∧.∩\n　　 ｒ（ ＾ω＾ ）ﾉ _\n　　└‐、　　　ﾚ´｀ヽ　　お断りします（優しく）\n　　　　 ヽ　　 _ノ⌒⌒ヽ\n　　　　　|　　　 ー LLPﾉ\n　　　　　ゝ　　　　　ノ\n　　　　　　　　　　　 ", //変更
            "　 Λ＿Λ\n　（ ・∀・ ）　　ワクワク\n　（　つ　つ\n　 `（＿）"
        ];
        const chuunibyouPhrases = [ 
            "我が名は…フフ、今はまだ名乗る時ではない…（キリッ）", "闇のオーラに包まれよ…永遠に！",  //変更
            "この世界は歪んでいる…真実の扉を開くのは我だ…！",
            "我が右目に宿りし古龍（エンシェントドラゴン）が目覚める…ッ！", "フハハハ！愛すべき人間どもよ！", //変更
            "禁断の聖典（アーティファクト）が囁く…",
            "我は混沌より生まれし原初の存在（プロトタイプ）…", "運命の輪（ホイール・オブ・フォーチュン）は、今、静かに回り始めたのだ…", "聖なる剣（エクスカリバー）に我が魂を賭けて…！",
            "魂の契約（ソウルコントラクト）に従い、汝を我が友として召喚する！", //変更
            "魂の共振（ソウルレゾナンス）を感じる…！お前もか…？", "選ばれし聖騎士（パラディン）よ、覚醒の刻は来た！いざ、聖なる戦いへ！", //変更
            "漆黒の翼を広げ、終末の黄昏空（トワイライトスカイ）へ…！", "この抑えきれぬ力（パワー）…世界が震えている…！", "世界樹（ユグドラシル）の祝福が、我らと共にあらんことを…アーメン。",
            "万物を見通す魔眼（イーヴィルアイ・オブ・トゥルース）が真実を暴き出す…！", "時は満ちた…神々の最終決戦のゴングを鳴らそう…", //変更
            "我が魂の奥義！エターナルシャイニングストーム！…くらえ！", //変更
            "くっ…！またこの秘めたる力が解放されるというのか…！？誰か見守っていてくれ…！", //変更
            "フッ…この程度の試練、乗り越えてみせる…（強がり）", //変更
            "この世の理（ルール）など、我という存在（イレギュラー）には通用せぬのだ！",
            "迷える魂よ、安らかなる場所へ…祈りを捧げよう…", //変更
            "我こそが世界の変革者にして再構築主（リ・クリエイター）…！刮目せよ！", //変更
            "深淵を覗き続ける時、深淵もまたこちらを覗き、そして魅了されるのだ…",
            "我が聖剣（カリバーン）に断てぬものなし！…と、思う今日この頃。", //変更
            "運命に抗い、そして切り開くことこそ、人間の最も美しい輝きよ…！", "我が魂に刻まれし古代の宿命（エンシェント・デスティニー）…もはや逃れることはできぬ！受け入れるのもまた一興だ！", //変更
            "天空より堕ちし者の涙が、この世界を潤すだろう…", //変更
            "変革の刻は近い…祝宴の準備を始めようか…", //変更
            "古の盟約に従い、汝に願う！力を貸してくれ！…プリーズ？" //変更
        ];


        function makeAsciiArtBlock() { 
            const art = getRandomElement(asciiArtSamples);
            const colors = getRandomElement(garishColorPairs);
            const limitedArt = art.split('\n').slice(0, getRandomInt(10, 20)).join('\n');
            return `<div class="ascii-art-block" style="border-color:${colors.text}; background-color:${colors.bg}; color:${colors.text}; transform: rotate(${getRandomInt(-5,5)}deg) scale(${getRandomInt(8,12)/10});">` + limitedArt + `</div>`;
        }
        function getRandomUglyStyle(isTextHeavy = false, forceComplementary = false) { 
            let style = `font-family: ${getRandomElement(badFonts)} !important; `;
            style += `font-size: ${getRandomInt(5, 55)}pt !important; `;
            const colors = getRandomElement(garishColorPairs);
            let finalBgColor = colors.bg;
            let finalTextColor = colors.text;

            if (forceComplementary || Math.random() < 0.85) { 
                const compPair = getRandomElement(garishColorPairs.filter(p => p.bg !== p.text && p.bg !== finalTextColor && p.text !== finalBgColor )); 
                finalBgColor = compPair.bg;
                finalTextColor = compPair.text;
            }

            style += `color: ${finalTextColor} !important; `;
            if (!isTextHeavy || Math.random() < 0.8) { 
                 style += `background-color: ${finalBgColor} !important; `;
            }
            if (Math.random() < 0.4 && !isTextHeavy) { 
                style += `background-image: linear-gradient(${getRandomInt(0,360)}deg, ${getRandomElement(garishColorPairs).bg}, ${getRandomElement(garishColorPairs).text}, ${getRandomElement(garishColorPairs).bg}, ${getRandomElement(garishColorPairs).text}) !important; animation: rainbow-bg-flow ${getRandomInt(1,3)}s linear infinite; background-size: 450% 450% !important;`;
            }
            if (Math.random() < 0.6) style += 'font-weight: 900 !important; ';
            if (Math.random() < 0.5) style += 'font-style: italic !important; ';
            if (Math.random() < 0.5) style += `text-decoration: ${getRandomElement(['underline', 'overline', 'line-through', 'underline overline', 'underline line-through', 'overline line-through', 'underline overline line-through'])} ${getRandomElement(garishColorPairs).text} ${getRandomElement(['wavy', 'dotted', 'dashed', 'double', 'solid'])} ${getRandomInt(2,6)}px !important; `;
            if (Math.random() < 0.4) style += `text-shadow: 5px 5px 0px ${finalBgColor}, -5px -5px 0px ${getRandomElement(garishColorPairs).text}, 0 0 12px ${getRandomElement(garishColorPairs).text}, 0 0 5px white !important;`;
            if (Math.random() < 0.3) style += `transform: rotate(${getRandomInt(-18, 18)}deg) skewX(${getRandomInt(-25,25)}deg) scale(${getRandomInt(8,12)/10}) !important; display:inline-block !important;`;
            if (Math.random() < 0.15) style += `border: ${getRandomInt(4,8)}px ${getRandomElement(['dotted', 'dashed', 'solid', 'double', 'groove', 'ridge', 'inset', 'outset'])} ${getRandomElement(garishColorPairs).text} !important; padding: 4px 8px !important; margin: 3px !important;`;
            if (Math.random() < 0.2) style += `letter-spacing: ${getRandomInt(-4, 8)}px !important;`;
            if (Math.random() < 0.2) style += `word-spacing: ${getRandomInt(-7, 18)}px !important;`;
            if (Math.random() < 0.15) style += `outline: ${getRandomInt(3,6)}px ${getRandomElement(['solid', 'dashed', 'dotted'])} ${getRandomElement(garishColorPairs).text} !important;`;
            return style;
        }
        function makeBlinking(text, customStyle = "") { 
             const style = customStyle || getRandomUglyStyle(false, true);
            return `<span class="ugly-blink" style="${style}">${text}</span>`;
        }
        function makeBlinkingIcon(icon) { 
            return `<span class="icon-blink" style="font-size:${getRandomInt(30,70)}pt; margin: 0 10px; vertical-align: middle; color:${getRandomElement(garishColorPairs).text}; text-shadow: 2px 2px ${getRandomElement(garishColorPairs).bg};">${icon}</span>`;
        }
        function makeMarquee(text, bgColor = 'gray', textColor = 'white') { 
            const marqueeStyle = getRandomUglyStyle(false, true);
            const bgPair = getRandomElement(garishColorPairs);
            return `
                <div class="ugly-marquee-container" style="background-color: ${bgPair.bg}; border: 7px ${getRandomElement(['dashed', 'dotted', 'double', 'groove', 'ridge'])} ${bgPair.text};">
                    <p class="ugly-marquee-text" style="color: ${textColor}; ${marqueeStyle}">
                        ${text.split('').map(char => `<span style="display:inline-block; transform: scale(${getRandomInt(6,20)/10}) rotate(${getRandomInt(-20,20)}deg) skewX(${getRandomInt(-10,10)}deg); padding: 0 2px;">${char}</span>`).join('')} ${makeBlinkingIcon(getRandomElement(uglyIcons))} ${makeBlinkingIcon(getRandomElement(uglyIcons))}
                    </p>
                </div>`;
        }
        function makeRainbowText(text) { 
            return `<span class="ugly-rainbow-text" style="font-size: ${getRandomInt(20,70)}pt !important; font-family: ${getRandomElement(badFonts)} !important; display:inline-block; padding: 3px; border: 2px dotted yellow;">${text}</span>`;
        }
        
        function makeAnimatedTitle(text) {
            const animationType = getRandomInt(1, 4); 
            let className = '';
            switch (animationType) {
                case 1: className = 'title-char-wavy'; break;
                case 2: className = 'title-char-bounce'; break;
                case 3: className = 'title-char-spinzoom'; break;
                case 4: className = 'title-char-shake'; break;
            }
            return text.split('').map((char, i) => `<span class="${className}" style="font-family:${getRandomElement(badFonts)} !important; color:${getRandomElement(garishColorPairs).text} !important; text-shadow: 3px 3px ${getRandomElement(garishColorPairs).bg} !important; animation-duration:${getRandomInt(15,30)/10}s; animation-delay:-${Math.random()*(animationType === 2 ? 0.8 : 2.0) + i*0.08}s; font-size: inherit !important;">${char === ' ' ? '&nbsp;' : char}</span>`).join('');
        }

        function makeSpeechBubbleCSS(text) { 
            const colors = getRandomElement(garishColorPairs);
            const bubbleStyle = getRandomUglyStyle(true, true);
            const tailPosition = getRandomInt(10,90);
            const tailRotation = getRandomInt(-20,20);
            const tailSize = getRandomInt(15,30);

            return `<div style="text-align:${getRandomElement(['left', 'center', 'right'])}; margin: 20px 0;">
                <div class="speech-bubble" style="${bubbleStyle} border-color:${colors.text} !important; background-color:${colors.bg} !important; color:${colors.text} !important; border-width:${getRandomInt(3,8)}px !important; border-style:${getRandomElement(['solid','dashed','dotted','double','groove','ridge'])} !important; box-shadow: 7px 7px 0 ${colors.text}, 0 0 15px ${colors.bg} !important; transform: rotate(${getRandomInt(-5,5)}deg) !important;">
                    ${text.replace(/\n/g, '<br>')}
                    <div style="position:absolute; bottom:-${tailSize - 3}px; left:${tailPosition}%; width:0; height:0; border-left: ${tailSize/2}px solid transparent; border-right: ${tailSize/2}px solid transparent; border-top: ${tailSize}px solid ${colors.text}; transform: rotate(${tailRotation}deg) translateX(-50%);"></div>
                    <div style="position:absolute; bottom:-${tailSize - 6}px; left:${tailPosition}%; margin-left:1px; width:0; height:0; border-left: ${tailSize/2 - 2}px solid transparent; border-right: ${tailSize/2 - 2}px solid transparent; border-top: ${tailSize - 3}px solid ${colors.bg}; transform: rotate(${tailRotation}deg) translateX(-50%);"></div>
                </div>
            </div>`;
        }
        function showUglyModal(title, message, gifSrc) { 
            document.getElementById('modalTitle').innerHTML = makeAnimatedTitle(title); 
            document.getElementById('modalTitle').style = getRandomUglyStyle(false, true);
            document.getElementById('modalMessage').innerHTML = message.split(' ').map(w => Math.random() < 0.1 ? makeBlinking(w) : w).join(' '); 
            document.getElementById('modalMessage').style = getRandomUglyStyle(true, true);
            
            document.getElementById('modalGif').src = gifSrc;
            document.getElementById('modalGif').style.transform = `rotate(${getRandomInt(-10,10)}deg) scale(${getRandomInt(9,11)/10})`; 
            document.getElementById('modalGif').style.border = `${getRandomInt(3,6)}px ${getRandomElement(['dotted', 'dashed'])} ${getRandomElement(garishColorPairs).text}`;

            const modalIconsContainer = document.getElementById('modalIcons');
            modalIconsContainer.innerHTML = '';
            for(let i=0; i<getRandomInt(2,5); i++){ 
                modalIconsContainer.innerHTML += makeBlinkingIcon(getRandomElement(uglyIcons));
            }

            const modal = document.getElementById('uglyModal');
            const modalColors = getRandomElement(garishColorPairs);
            modal.style.backgroundColor = modalColors.bg;
            modal.style.color = modalColors.text;
            modal.style.fontFamily = getRandomElement(badFonts);
            if (Math.random() < 0.4) modal.classList.add('ugly-rainbow-bg'); 
            modal.style.display = 'block';
            
            const closeButton = document.getElementById('closeModalButton');
            const buttonColors = getRandomElement(garishColorPairs);
            closeButton.style.backgroundColor = buttonColors.bg;
            closeButton.style.color = buttonColors.text;
            closeButton.style.fontFamily = getRandomElement(badFonts);
            closeButton.style.fontSize = `${getRandomInt(12,22)}pt`; 
            closeButton.innerHTML = makeBlinking(closeButton.textContent, `font-size:${getRandomInt(12,22)}pt; ${getRandomUglyStyle(false, true)}`);
        }

        document.getElementById('closeModalButton').addEventListener('click', () => {
            document.getElementById('uglyModal').style.display = 'none';
            document.getElementById('uglyModal').classList.remove('ugly-rainbow-bg');
            if (Tone.Transport.state === "started") { 
                Tone.Transport.stop();
                if(part) part.dispose(); 
            }
        });
        
        document.getElementById('mainTitleContainer').innerHTML = makeAnimatedTitle("【最終形態Ver.2.3】激ダサホームページメーカー"); // バージョン更新

        const downloadButton = document.getElementById('downloadButton');
        downloadButton.addEventListener('click', () => { 
            const outputAreaNode = document.getElementById('outputArea');
            const generatedContentNode = outputAreaNode.querySelector('#generatedContent');
            if (!generatedContentNode) {
                console.error("Error: #generatedContent not found for download.");
                return;
            }
            const generatedHtml = generatedContentNode.innerHTML;

            const pageTitleInput = document.getElementById('pageTitle').value || "激ダサホームページ・最終形態Ver2.3"; // バージョン更新
            const sanitizedPageTitle = pageTitleInput.replace(/[^a-z0-9_-\u3040-\u30FF\u4E00-\u9FFF]/gi, '_');
            
            let styleContent = "";
            const styleSheets = document.styleSheets;
            for (let i = 0; i < styleSheets.length; i++) {
                const sheet = styleSheets[i];
                if (sheet.href && (sheet.href.includes('tailwindcss') || sheet.href.includes('tone'))) {
                    continue;
                }
                try {
                    const rules = sheet.cssRules || sheet.rules;
                    for (let j = 0; j < rules.length; j++) {
                        const rule = rules[j];
                        if (rule.cssText.includes('@keyframes') || 
                            (rule.selectorText && (
                                rule.selectorText.includes('.ugly-') ||
                                rule.selectorText.includes('.ascii-art-block') ||
                                rule.selectorText.includes('.title-char-') ||
                                rule.selectorText.includes('#generatedContent') 
                            ))
                           ) {
                            styleContent += rule.cssText + '\n';
                        }
                    }
                } catch (e) {
                    // console.warn("Could not read CSS rules from stylesheet: " + (sheet.href || 'inline sheet'), e);
                }
            }
            styleContent += `
                #generatedContent * { box-sizing: border-box !important; margin:0 !important; padding:0 !important; }
                #generatedContent table, #generatedContent th, #generatedContent td { border-collapse: separate !important; caption-side: bottom !important; }
                #generatedContent img { max-width: 100% !important; height: auto !important; display: block !important; margin: 12px auto !important; border: 6px solid yellow !important; }
            `;


            let fullHtml = `<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><title>${sanitizedPageTitle}</title><style>${styleContent}</style></head><body><div id="generatedContent">${generatedHtml}</div></body></html>`;

            const blob = new Blob([fullHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${sanitizedPageTitle}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });


        document.getElementById('generateButton').addEventListener('click', () => {
            playUglyMidi(); 

            const userTitle = document.getElementById('pageTitle').value || "無題の電脳覇王 in サイバースペース・ジ・エンド・オブ・ワールド";
            const userContent = document.getElementById('pageContent').value || "ここに何か宇宙規模のすごいことが書いてあったはずなんだ…思い出せないけど。まあ、気にしないでくれ！と言いつつ、やっぱり気にしてほしい自分がいる今日この頃、皆様いかがお過ごしでしょうか？刮目せよ！そして崇めよ！我が闇の聖典（ダークバイブル）に記されし真実を！";
            const outputArea = document.getElementById('outputArea');

            showUglyModal( 
                getRandomElement(["でけたで！", "注目！", "見てくれ！すごい（ダサい）のができたぞ！"]),
                "ダサさと見にくさを追求したページが錬成されたぞ！ゆっくり見ていってね！",
                getRandomElement(classicGifs)
            );

            let html = ''; 
            const bodyColors = getRandomElement(garishColorPairs);
            let overallStyle = `background-color: ${bodyColors.bg} !important; color: ${bodyColors.text} !important; font-family: ${getRandomElement(badFonts)} !important; padding: 30px !important; border: 30px ${getRandomElement(['groove', 'ridge', 'inset', 'outset', 'double'])} ${getRandomElement(garishColorPairs).bg} !important;`;
            if (Math.random() < 0.7) overallStyle += ` background-image: url('https://placehold.co/60x60/${getRandomElement(garishColorPairs).bg.substring(1)}/${getRandomElement(garishColorPairs).text.substring(1)}/gif?text=カオス&font=impact'); background-repeat: repeat !important; background-blend-mode: ${getRandomElement(['multiply', 'screen', 'overlay', 'darken', 'lighten', 'color-dodge', 'color-burn', 'hard-light', 'soft-light', 'difference', 'exclusion', 'hue', 'saturation', 'color', 'luminosity'])} !important;`;
            if (Math.random() < 0.6) overallStyle = `padding: 30px !important; border: 30px ${getRandomElement(['groove', 'ridge', 'inset', 'outset', 'double'])} ${getRandomElement(garishColorPairs).bg} !important;` + ` class="ugly-rainbow-bg"`;

            
            let generatedPageContent = ''; // 生成されるページ内容はこちらに貯める

            let siteTitle = userTitle;
            if (Math.random() < 0.98) siteTitle = getRandomElement(titlePrefixes) + siteTitle; 
            if (Math.random() < 0.98) siteTitle += getRandomElement(titleSuffixes); 
            
            generatedPageContent += `<center style="margin-bottom:30px;">`;
            const titleEffectType = getRandomInt(1,7); 
            if (titleEffectType <= 2) { 
                generatedPageContent += `<h1 style="font-size:${getRandomInt(40,100)}pt !important; line-height:1.5;">${makeAnimatedTitle(siteTitle)}</h1>`;
            } else if (titleEffectType === 3) {
                generatedPageContent += makeMarquee(siteTitle, getRandomElement(garishColorPairs).bg, getRandomElement(garishColorPairs).text);
            } else if (titleEffectType === 4) {
                generatedPageContent += `<h1 style="${getRandomUglyStyle(false, true)}font-size:${getRandomInt(45,90)}pt !important;">${makeBlinking(siteTitle)}</h1>`;
            } else if (titleEffectType === 5) {
                 generatedPageContent += `<h1 style="${getRandomUglyStyle(false, true)}font-size:${getRandomInt(45,90)}pt !important;">${makeRainbowText(siteTitle)}</h1>`;
            } else if (titleEffectType === 6) {
                generatedPageContent += `<h1 style="font-size:${getRandomInt(40,90)}pt !important; line-height:1.5; word-break:break-all;">${siteTitle.split('').map(char => `<span style="${getRandomUglyStyle(false, true)} display:inline-block !important; padding:0 4px !important; margin: 0 1px !important;">${char}</span>`).join('')}</h1>`;
            } else { 
                generatedPageContent += `<div style="padding:15px; border: 7px groove ${getRandomElement(garishColorPairs).text}; background-color:${getRandomElement(garishColorPairs).bg}; transform: rotate(${getRandomInt(-3,3)}deg);">${makeAsciiArtBlock()}</div><h2 style="${getRandomUglyStyle(false,true)}font-size:${getRandomInt(20,50)}pt !important;">${siteTitle}</h2>`;
            }
            generatedPageContent += `<p style="margin-top:25px;">${makeBlinkingIcon(getRandomElement(uglyIcons))} <img src="${getRandomElement(classicGifs)}" alt="Cool GIF" style="transform:rotate(${getRandomInt(-35,35)}deg) scale(${getRandomInt(6,14)/10}) skewX(${getRandomInt(-10,10)}deg) !important; display:inline-block !important; vertical-align:middle !important;"> ${makeBlinkingIcon(getRandomElement(uglyIcons))} <img src="${getRandomElement(classicGifs)}" alt="Another Cool GIF" style="transform:scaleX(-1) rotate(${getRandomInt(-35,35)}deg) scale(${getRandomInt(6,14)/10}) skewY(${getRandomInt(-10,10)}deg) !important; display:inline-block !important; vertical-align:middle !important;"> ${makeBlinkingIcon(getRandomElement(uglyIcons))}</p>`;
            generatedPageContent += `</center><hr style="border: 12px ${getRandomElement(['dashed', 'dotted', 'double', 'groove', 'ridge', 'inset', 'outset'])} ${getRandomElement(garishColorPairs).bg} !important; margin: 35px 0 !important; transform: rotate(${getRandomInt(-2,2)}deg) !important;">`;

            generatedPageContent += `<p style="${getRandomUglyStyle(true, true)}">ようこそ我が名は<strong style="color:red !important; font-size:220% !important; ${getRandomUglyStyle(false, true)}">${userTitle}</strong>！この電脳空間の深淵、いや、混沌の坩堝、終末の宴、そして絶望のカーニバルへ！ ${getRandomElement(kaomojiSymbols)} ${makeBlinkingIcon(getRandomElement(uglyIcons))} ${getRandomElement(chuunibyouPhrases)}</p>`;
            generatedPageContent += `<p style="${getRandomUglyStyle(true, true)}">${getRandomElement(verboseLeadIns)}このサイトの管理人、つまりこのワタクシ様が、汗と涙とその他いろいろな液体と魂の欠片を犠牲にして（大嘘）作り上げた、珠玉の（？）いや、魔境の、いや、おもしろコンテンツをとくとご覧あれ！ ${getRandomElement(verboseTrailOuts)}</p>`; //表現変更
            if (Math.random() < 0.7) generatedPageContent += `<p style="${getRandomUglyStyle(true, true)}font-size:7pt !important;">${getRandomElement(pseudoBusinessJargon)} ${getRandomElement(kaomojiSymbols)} ${getRandomElement(chuunibyouPhrases)}</p>`;
            if (Math.random() < 0.5) generatedPageContent += `<div style="text-align:center; margin:20px 0; padding: 5px; border: 3px dashed ${getRandomElement(garishColorPairs).text}; background-color:${getRandomElement(garishColorPairs).bg};">${makeAsciiArtBlock()}</div>`;
            generatedPageContent += `<br><br>`;

            const paragraphs = userContent.split('\n').filter(p => p.trim() !== '');
            paragraphs.forEach((para, index) => {
                let processedPara = para;
                if (Math.random() < 0.85) { 
                    processedPara = `${getRandomElement(verboseLeadIns)} ${processedPara} ${getRandomElement(verboseTrailOuts)}`;
                }
                if (Math.random() < 0.7) { 
                    processedPara = `<strong style="font-size:150% !important; ${getRandomUglyStyle(false, true)}">【超絶最終禁断重要機密事項Ver.X】</strong> ${processedPara} <strong style="color: ${getRandomElement(garishColorPairs).text} !important; background-color: ${getRandomElement(garishColorPairs).bg} !important; padding:8px !important; border:5px solid yellow !important; display:inline-block !important; transform: rotate(${getRandomInt(-3,3)}deg) !important;">ここ、マジでテストに出るからな！魂に刻み込んどけよ！ ${getRandomElement(oldNetSlang)} ${getRandomElement(kaomojiSymbols)} ${getRandomElement(chuunibyouPhrases)}</strong>`;
                }
                if (Math.random() < 0.6) { 
                    processedPara = processedPara.split(' ').map(word => {
                        if (Math.random() < 0.35) return `<span style="font-size:${getRandomInt(7,70)}pt !important; font-family:${getRandomElement(badFonts)} !important; color:${getRandomElement(garishColorPairs).text} !important; background-color:${getRandomElement(garishColorPairs).bg} !important; transform:rotate(${getRandomInt(-18,18)}deg) scale(${getRandomInt(4,20)/10}) skewX(${getRandomInt(-12,12)}deg) !important; display:inline-block !important; padding:0 5px !important; margin:0 4px !important; border: ${getRandomInt(1,4)}px ${getRandomElement(['dotted','dashed'])} ${getRandomElement(garishColorPairs).text} !important;">${word}</span>`;
                        return word;
                    }).join(' ');
                }
                if (Math.random() < 0.25) processedPara = `${getRandomElement(chuunibyouPhrases)} ${processedPara} ${getRandomElement(chuunibyouPhrases)}`;


                const displayType = getRandomInt(1,15); 
                if (displayType <= 2 && para.length > 3) { 
                     generatedPageContent += makeSpeechBubbleCSS(processedPara);
                } else if (displayType <= 5) { 
                     generatedPageContent += `<div style="text-align:center; margin: 25px 0; padding:10px; border: 5px ${getRandomElement(['dashed','dotted'])} ${getRandomElement(garishColorPairs).bg}; background-color:${getRandomElement(garishColorPairs).text};">${makeAsciiArtBlock()} <p style="${getRandomUglyStyle(true,true)}font-size:0.8em !important;">${processedPara.substring(0,getRandomInt(5,25))}... ${getRandomElement(chuunibyouPhrases)}</p></div>`;
                } else if (displayType <= 7 && para.length > 10) { 
                     generatedPageContent += `<br><table style="width:${getRandomInt(25,100)}% !important; margin:30px auto !important; ${getRandomUglyStyle(false, true)} transform: rotate(${getRandomInt(-2,2)}deg) skewX(${getRandomInt(-3,3)}deg) !important;"><caption><strong style="${getRandomUglyStyle(false, true)}font-size:2em !important;">${makeBlinking(getRandomElement(["謎の最終データ表","極秘開示情報","今日の魂のメロディ"]))}</strong></caption><thead><tr><th style="${getRandomUglyStyle(false, true)}">${makeBlinking("情報Ω改")}</th><th style="${getRandomUglyStyle(false, true)}">${makeRainbowText("情報ΨNEO")}</th><th style="${getRandomUglyStyle(false, true)}">情報ΔZERO</th></tr></thead><tbody><tr><td style="${getRandomUglyStyle(true, true)}">${para.substring(0,getRandomInt(2,10))}... ${getRandomElement(kaomojiSymbols)} ${makeBlinkingIcon(getRandomElement(uglyIcons))} ${getRandomElement(chuunibyouPhrases)}</td><td style="${getRandomUglyStyle(true, true)}">${getRandomElement(annotations)}</td><td style="${getRandomUglyStyle(true, true)}">${makeAsciiArtBlock()} ${getRandomElement(oldNetSlang)} ${getRandomElement(chuunibyouPhrases)}</td></tr></tbody></table>`; //表現変更
                } else if (displayType <= 9) { 
                    generatedPageContent += `<p style="${getRandomUglyStyle(false, true)} font-size:${getRandomInt(15,40)}pt !important; text-align:center; margin: 20px 0; padding:10px; border:3px solid ${getRandomElement(garishColorPairs).text}; background-color:${getRandomElement(garishColorPairs).bg};">${makeAnimatedTitle(getRandomElement(chuunibyouPhrases))}</p>`;
                }
                else { 
                    generatedPageContent += `<div style="margin-bottom: 40px !important; padding:30px !important; border: 8px ${getRandomElement(['dotted', 'dashed', 'double', 'groove', 'ridge'])} ${getRandomElement(garishColorPairs).bg} !important; ${getRandomUglyStyle(true, true)} transform: rotate(${getRandomInt(-2,2)}deg) !important;">`;
                    const words = processedPara.split(' ');
                    let styledPara = words.map(word => {
                        if (Math.random() < 0.2) return makeBlinking(word, getRandomUglyStyle(false, true));
                        if (Math.random() < 0.15) return makeRainbowText(word);
                        if (Math.random() < 0.1) return `<span style="display:inline-block !important; transform:rotate(${getRandomInt(-30,30)}deg) scale(${getRandomInt(4,20)/10}) skewY(${getRandomInt(-18,18)}deg) !important; font-family:${getRandomElement(badFonts)} !important; ${getRandomUglyStyle(false, true)}">${word}</span>`;
                        if (Math.random() < 0.3) return `<strong style="font-size:${getRandomInt(7,70)}pt !important; color:${getRandomElement(garishColorPairs).text} !important; background-color:${getRandomElement(garishColorPairs).bg} !important; padding: 0 6px !important; margin: 0 3px !important; display:inline-block !important; border: ${getRandomInt(1,4)}px ${getRandomElement(['solid','dotted'])} ${getRandomElement(garishColorPairs).text} !important;">${word}</strong>`;
                        return word;
                    }).join(' ');
                    generatedPageContent += `<p style="line-height:${getRandomInt(7,35)/10} !important; overflow-wrap: break-word !important; word-break: break-all !important;">${styledPara} ${Math.random() < 0.4 ? getRandomElement(kaomojiSymbols) : ''}  ${Math.random() < 0.15 ? makeBlinkingIcon(getRandomElement(uglyIcons)) : ''} ${Math.random() < 0.2 ? getRandomElement(chuunibyouPhrases) : ''}</p>`;
                    if (Math.random() < 0.3) generatedPageContent += `<div style="text-align:center; margin-top:15px; padding: 5px; border: 2px dashed ${getRandomElement(garishColorPairs).text};">${makeAsciiArtBlock()}</div>`;
                    generatedPageContent += `</div>`;
                }

                if (Math.random() < 0.95 && displayType > 2) { 
                    generatedPageContent += `<span style="font-size: ${getRandomInt(1,12)}pt !important; color: ${getRandomElement(garishColorPairs).text} !important; background-color: ${getRandomElement(garishColorPairs).bg} !important; display:block !important; text-align:${getRandomElement(['left','center','right'])} !important; padding: 5px 10px !important; margin-top: -25px !important; margin-bottom:25px !important; transform: rotate(${getRandomInt(-8,8)}deg) skewX(${getRandomInt(-18,18)}deg) !important; border: 2px ${getRandomElement(['dotted','dashed'])} ${getRandomElement(garishColorPairs).text} !important;">${getRandomElement(annotations)} ${Math.random() < 0.5 ? getRandomElement(oldNetSlang) : ''} ${Math.random() < 0.3 ? getRandomElement(kaomojiSymbols) : ''} ${Math.random() < 0.2 ? getRandomElement(chuunibyouPhrases) : ''}</span>`;
                }
                if (Math.random() < 0.5) { 
                    generatedPageContent += `<center><img src="${getRandomElement(placeholderImages)}" alt="謎の最終禁断画像" style="border: 15px ${getRandomElement(['solid','dotted','dashed','double','groove','ridge','inset','outset'])} ${getRandomElement(garishColorPairs).bg} !important; margin:30px 0 !important; transform: rotate(${getRandomInt(-25,25)}deg) scale(${getRandomInt(4,15)/10}) skewX(${getRandomInt(-15,15)}deg) !important; box-shadow: 12px 12px 25px ${getRandomElement(garishColorPairs).text}, 0 0 10px white !important;"></center>`;
                }
                if (Math.random() < 0.25) generatedPageContent += `<p style="${getRandomUglyStyle(true, true)}font-size:7pt !important;">${getRandomElement(pseudoBusinessJargon)} ${getRandomElement(kaomojiSymbols)} ${makeBlinkingIcon(getRandomElement(uglyIcons))} ${getRandomElement(chuunibyouPhrases)}</p>`;

                if (index < paragraphs.length -1) generatedPageContent += `<br><hr style="border-top: ${getRandomInt(6,15)}px ${getRandomElement(['dotted', 'dashed', 'double', 'groove', 'ridge', 'inset'])} ${getRandomElement(garishColorPairs).text} !important; margin: 25px 0 ${getRandomInt(25,45)}px 0 !important; height:${getRandomInt(10,25)}px !important; background-color:${getRandomElement(garishColorPairs).bg} !important; transform: skewX(${getRandomInt(-12,12)}deg) rotate(${getRandomInt(-2,2)}deg) !important;"><br>`;
            });

            generatedPageContent += `<hr style="border-top: 15px double ${getRandomElement(garishColorPairs).bg} !important; margin-top:60px !important;">`;
            generatedPageContent += `<p style="${getRandomUglyStyle(false, true)}">どうだったかな？この<strong style="font-size:250% !important; ${getRandomUglyStyle(false, true)}" class="ugly-blink">${userTitle}</strong>のページは、君の目に新しい刺激を与えられたかな？ ${getRandomElement(kaomojiSymbols)} ${makeBlinkingIcon(getRandomElement(uglyIcons))} ${getRandomElement(chuunibyouPhrases)}</p>`;
            generatedPageContent += `<p style="font-family: '${getRandomElement(badFonts)}', cursive !important; font-size: ${getRandomInt(3,18)}pt !important; text-align:center !important; ${getRandomUglyStyle(true, true)}">${getRandomElement(verboseLeadIns)}またのお越しを、心よりお待ち申し上げておりますぞ！ ${getRandomElement(verboseTrailOuts)} ${makeBlinkingIcon(getRandomElement(uglyIcons))} ${getRandomElement(oldNetSlang)} ${makeBlinkingIcon(getRandomElement(uglyIcons))} ${getRandomElement(chuunibyouPhrases)}</p>`;
            if (Math.random() < 0.6) generatedPageContent += `<div style="text-align:center; margin: 25px 0; padding:10px; border:4px groove ${getRandomElement(garishColorPairs).text}; background-color:${getRandomElement(garishColorPairs).bg};">${makeAsciiArtBlock()}</div>`;

            generatedPageContent += `<hr style="height:30px !important; background-image: linear-gradient(to right, ${getRandomElement(garishColorPairs).bg}, ${getRandomElement(garishColorPairs).text}, ${getRandomElement(garishColorPairs).bg}, ${getRandomElement(garishColorPairs).text}, ${getRandomElement(garishColorPairs).bg}, ${getRandomElement(garishColorPairs).text}, ${getRandomElement(garishColorPairs).bg}, ${getRandomElement(garishColorPairs).text}, ${getRandomElement(garishColorPairs).bg}) !important; border:none !important; margin: 40px 0 !important; transform: skewY(${getRandomInt(-3,3)}deg) !important;">`;
            generatedPageContent += `<div style="text-align: center !important; ${getRandomUglyStyle(false, true)} padding: 10px !important;" class="${Math.random() < 0.5 ? 'ugly-rainbow-bg' : ''}">`;
            generatedPageContent += `<p style="line-height:2.2 !important; font-size:0.7em !important;">アクセスカウンター: <img src="https://placehold.co/200x80/${getRandomElement(garishColorPairs).bg.substring(1)}/${getRandomElement(garishColorPairs).text.substring(1)}/?text=${getRandomInt(10000000,999999999)}&font=impact" alt="アクセスカウンター" style="display:inline-block !important; vertical-align:middle !important; border:4px solid red !important; transform: rotate(${getRandomInt(-5,5)}deg) !important;"> 人目のお客様だ！キリ番ゲッターはBBSに魂のポエムと若気の至りをカキコ必須な！ ${makeBlinkingIcon("🎊")} ${makeBlinkingIcon("💯")} ${makeBlinkingIcon("💸")}</p>`; //表現変更
            generatedPageContent += `<p style="line-height:2.2 !important; font-size:0.7em !important;"><img src="${getRandomElement(classicGifs)}" alt="工事中" style="display:inline-block !important; vertical-align:middle !important; transform: scale(${getRandomInt(8,12)/10}) !important;"> このサイトは Netscape Navigator -1.0 及び Internet Explorer 0.0 で最適に表示されるようには全くこれっぽっちも微塵も輪廻転生しても作られていませんが、魂と気合と愛と勇気で見てください。推奨環境はカオスとユーモアです。</p>`; //表現変更
            generatedPageContent += `<p style="font-size: 4pt !important; line-height:2 !important; word-break:break-all !important;">(C) 1XXX - ${new Date().getFullYear()} ${userTitle}の電脳秘密結社NEOアマゾネス最終決戦黙示録RETURNS FOREVER. All rights maybe reserved, maybe not. Who cares? Don't sue me plz. If you can read this, you are awesome. This site is full of mystery. ${getRandomElement(kaomojiSymbols)} ${getRandomElement(oldNetSlang)} ${getRandomElement(chuunibyouPhrases)}</p>`; //表現変更
            generatedPageContent += `<a href="#" style="${getRandomUglyStyle(false, true)}font-size:1.5em !important; display:inline-block; margin:5px; padding:5px; border:2px solid;">${makeBlinking("ゲストブックに魂の叫びとポエムと若気の至りを記帳！")}</a> | <a href="#" style="${getRandomUglyStyle(false, true)}font-size:1.5em !important; display:inline-block; margin:5px; padding:5px; border:2px solid;">${makeRainbowText("お友達リンク（絶滅危惧種・保護対象）")}</a> | <a href="#" style="${getRandomUglyStyle(false, true)}font-size:1.5em !important; display:inline-block; margin:5px; padding:5px; border:2px solid;">管理人にファンレター（届いたら嬉しいな、読まれたらもっと嬉しいな、返事が来たら踊っちゃうかも！）</a>`; //表現変更
            generatedPageContent += `</div>`;
            
            html += generatedPageContent + `</div>`; // generatedContent の閉じ

            outputArea.innerHTML = html; 
            downloadButton.style.display = 'block';
        });

    </script>
</body>
</html>
